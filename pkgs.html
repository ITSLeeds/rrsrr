<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 R packages | Reproducible road safety research with R: A practical introduction</title>
  <meta name="description" content="A reproducible and open source approach to applied road safety research" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="4 R packages | Reproducible road safety research with R: A practical introduction" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://saferactive.github.io/rrsrr/" />
  
  <meta property="og:description" content="A reproducible and open source approach to applied road safety research" />
  <meta name="github-repo" content="saferactive/rrsrr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 R packages | Reproducible road safety research with R: A practical introduction" />
  
  <meta name="twitter:description" content="A reproducible and open source approach to applied road safety research" />
  

<meta name="author" content="Robin Lovelace" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rstudio.html"/>
<link rel="next" href="data.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thanks"><i class="fa fa-check"></i>Thanks</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#reproducibility"><i class="fa fa-check"></i><b>1.1</b> Reproducibility</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-is-r"><i class="fa fa-check"></i><b>1.2</b> What is R?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#why-r-for-road-safety-research"><i class="fa fa-check"></i><b>1.3</b> Why R for road safety research?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>1.4</b> Prerequisites</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#installing-r-and-rstudio"><i class="fa fa-check"></i><b>1.5</b> Installing R and RStudio</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#r-in-the-cloud"><i class="fa fa-check"></i><b>1.6</b> R in the cloud</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#install-pkgs"><i class="fa fa-check"></i><b>1.7</b> Recommended packages</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#overview"><i class="fa fa-check"></i><b>1.8</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> R basics</a><ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#creating-and-removing-r-objects"><i class="fa fa-check"></i><b>2.1</b> Creating and removing R objects</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#object-types-vectors-and-data-frames"><i class="fa fa-check"></i><b>2.2</b> Object types: vectors and data frames</a></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#subsetting-by-index-or-column-name"><i class="fa fa-check"></i><b>2.3</b> Subsetting by index or column name</a></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#subsetting-by-values"><i class="fa fa-check"></i><b>2.4</b> Subsetting by values</a></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#dealing-with-nas-and-recoding"><i class="fa fa-check"></i><b>2.5</b> Dealing with NAs and recoding</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#changing-class"><i class="fa fa-check"></i><b>2.6</b> Changing class</a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#recoding-values"><i class="fa fa-check"></i><b>2.7</b> Recoding values</a></li>
<li class="chapter" data-level="2.8" data-path="basics.html"><a href="basics.html#saving-r-objects"><i class="fa fa-check"></i><b>2.8</b> Saving R objects</a></li>
<li class="chapter" data-level="2.9" data-path="basics.html"><a href="basics.html#now-you-are-ready-to-use-rstudio"><i class="fa fa-check"></i><b>2.9</b> Now you are ready to use RStudio</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>3</b> Using RStudio</a><ul>
<li class="chapter" data-level="3.1" data-path="rstudio.html"><a href="rstudio.html#projects-and-scripts"><i class="fa fa-check"></i><b>3.1</b> Projects and scripts</a></li>
<li class="chapter" data-level="3.2" data-path="rstudio.html"><a href="rstudio.html#writing-and-running-code"><i class="fa fa-check"></i><b>3.2</b> Writing and running code</a></li>
<li class="chapter" data-level="3.3" data-path="rstudio.html"><a href="rstudio.html#viewing-objects"><i class="fa fa-check"></i><b>3.3</b> Viewing Objects</a></li>
<li class="chapter" data-level="3.4" data-path="rstudio.html"><a href="rstudio.html#autocompletion"><i class="fa fa-check"></i><b>3.4</b> Autocompletion</a></li>
<li class="chapter" data-level="3.5" data-path="rstudio.html"><a href="rstudio.html#getting-help"><i class="fa fa-check"></i><b>3.5</b> Getting help</a></li>
<li class="chapter" data-level="3.6" data-path="rstudio.html"><a href="rstudio.html#commenting-code"><i class="fa fa-check"></i><b>3.6</b> Commenting Code</a></li>
<li class="chapter" data-level="3.7" data-path="rstudio.html"><a href="rstudio.html#the-global-environment"><i class="fa fa-check"></i><b>3.7</b> The global environment</a></li>
<li class="chapter" data-level="3.8" data-path="rstudio.html"><a href="rstudio.html#debugging-code"><i class="fa fa-check"></i><b>3.8</b> Debugging Code</a></li>
<li class="chapter" data-level="3.9" data-path="rstudio.html"><a href="rstudio.html#productivity-boosting-features"><i class="fa fa-check"></i><b>3.9</b> Productivity boosting features</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pkgs.html"><a href="pkgs.html"><i class="fa fa-check"></i><b>4</b> R packages</a><ul>
<li class="chapter" data-level="4.1" data-path="pkgs.html"><a href="pkgs.html#what-are-packages"><i class="fa fa-check"></i><b>4.1</b> What are packages?</a></li>
<li class="chapter" data-level="4.2" data-path="pkgs.html"><a href="pkgs.html#the-stats19-r-package"><i class="fa fa-check"></i><b>4.2</b> The stats19 R package</a></li>
<li class="chapter" data-level="4.3" data-path="pkgs.html"><a href="pkgs.html#installing-packages"><i class="fa fa-check"></i><b>4.3</b> Installing packages</a></li>
<li class="chapter" data-level="4.4" data-path="pkgs.html"><a href="pkgs.html#loading-packages"><i class="fa fa-check"></i><b>4.4</b> Loading packages</a></li>
<li class="chapter" data-level="4.5" data-path="pkgs.html"><a href="pkgs.html#using-packages"><i class="fa fa-check"></i><b>4.5</b> Using packages</a></li>
<li class="chapter" data-level="4.6" data-path="pkgs.html"><a href="pkgs.html#updating-packages"><i class="fa fa-check"></i><b>4.6</b> Updating packages</a></li>
<li class="chapter" data-level="4.7" data-path="pkgs.html"><a href="pkgs.html#ggplot2"><i class="fa fa-check"></i><b>4.7</b> ggplot2</a></li>
<li class="chapter" data-level="4.8" data-path="pkgs.html"><a href="pkgs.html#dplyr"><i class="fa fa-check"></i><b>4.8</b> dplyr</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>5</b> Manipulating data</a><ul>
<li class="chapter" data-level="5.1" data-path="data.html"><a href="data.html#tibbles"><i class="fa fa-check"></i><b>5.1</b> tibbles</a></li>
<li class="chapter" data-level="5.2" data-path="data.html"><a href="data.html#filter-and-select-rows-and-columns"><i class="fa fa-check"></i><b>5.2</b> filter() and select() rows and columns</a></li>
<li class="chapter" data-level="5.3" data-path="data.html"><a href="data.html#ordering-and-selecting-the-top-n"><i class="fa fa-check"></i><b>5.3</b> Ordering and selecting the ‘top n’</a></li>
<li class="chapter" data-level="5.4" data-path="data.html"><a href="data.html#summarise"><i class="fa fa-check"></i><b>5.4</b> Summarise</a></li>
<li class="chapter" data-level="5.5" data-path="data.html"><a href="data.html#tidyverse-exercises"><i class="fa fa-check"></i><b>5.5</b> Tidyverse exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>6</b> Temporal data</a><ul>
<li class="chapter" data-level="6.1" data-path="time.html"><a href="time.html#temporal-analysis-of-crash-data"><i class="fa fa-check"></i><b>6.1</b> Temporal analysis of crash data</a></li>
<li class="chapter" data-level="6.2" data-path="time.html"><a href="time.html#handling-dates-and-date-times"><i class="fa fa-check"></i><b>6.2</b> Handling dates and date-times</a></li>
<li class="chapter" data-level="6.3" data-path="time.html"><a href="time.html#hours-minutes-seconds-with-hms"><i class="fa fa-check"></i><b>6.3</b> Hours, minutes seconds with hms</a></li>
<li class="chapter" data-level="6.4" data-path="time.html"><a href="time.html#the-lubridate-package"><i class="fa fa-check"></i><b>6.4</b> The lubridate package</a></li>
<li class="chapter" data-level="6.5" data-path="time.html"><a href="time.html#dates-in-a-data-frame"><i class="fa fa-check"></i><b>6.5</b> Dates in a data frame</a></li>
<li class="chapter" data-level="6.6" data-path="time.html"><a href="time.html#components-of-time-objects"><i class="fa fa-check"></i><b>6.6</b> Components of time objects</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="space.html"><a href="space.html"><i class="fa fa-check"></i><b>7</b> Spatial data</a><ul>
<li class="chapter" data-level="7.1" data-path="space.html"><a href="space.html#sf-objects"><i class="fa fa-check"></i><b>7.1</b> sf objects</a></li>
<li class="chapter" data-level="7.2" data-path="space.html"><a href="space.html#reading-and-writing-spatial-data"><i class="fa fa-check"></i><b>7.2</b> Reading and writing spatial data</a></li>
<li class="chapter" data-level="7.3" data-path="space.html"><a href="space.html#sf-polygons"><i class="fa fa-check"></i><b>7.3</b> sf polygons</a></li>
<li class="chapter" data-level="7.4" data-path="space.html"><a href="space.html#spatial-subsetting-and-sf-plotting"><i class="fa fa-check"></i><b>7.4</b> Spatial subsetting and sf plotting</a></li>
<li class="chapter" data-level="7.5" data-path="space.html"><a href="space.html#geographic-joins"><i class="fa fa-check"></i><b>7.5</b> Geographic joins</a></li>
<li class="chapter" data-level="7.6" data-path="space.html"><a href="space.html#coordinate-reference-systems"><i class="fa fa-check"></i><b>7.6</b> Coordinate Reference Systems</a></li>
<li class="chapter" data-level="7.7" data-path="space.html"><a href="space.html#buffers"><i class="fa fa-check"></i><b>7.7</b> Buffers</a></li>
<li class="chapter" data-level="7.8" data-path="space.html"><a href="space.html#attribute-operations-on-sf-objects"><i class="fa fa-check"></i><b>7.8</b> Attribute operations on sf objects</a></li>
<li class="chapter" data-level="7.9" data-path="space.html"><a href="space.html#mapping-road-crash-data"><i class="fa fa-check"></i><b>7.9</b> Mapping road crash data</a></li>
<li class="chapter" data-level="7.10" data-path="space.html"><a href="space.html#analysing-point-data"><i class="fa fa-check"></i><b>7.10</b> Analysing point data</a></li>
<li class="chapter" data-level="7.11" data-path="space.html"><a href="space.html#analysing-crash-data-on-road-networks"><i class="fa fa-check"></i><b>7.11</b> Analysing crash data on road networks</a></li>
<li class="chapter" data-level="" data-path="space.html"><a href="space.html#bonus-exercises"><i class="fa fa-check"></i>Bonus exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="join.html"><a href="join.html"><i class="fa fa-check"></i><b>8</b> Joining road crash tables</a><ul>
<li class="chapter" data-level="8.1" data-path="join.html"><a href="join.html#stats19-tables"><i class="fa fa-check"></i><b>8.1</b> STATS19 tables</a></li>
<li class="chapter" data-level="8.2" data-path="join.html"><a href="join.html#locality"><i class="fa fa-check"></i><b>8.2</b> Locality</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="next.html"><a href="next.html"><i class="fa fa-check"></i><b>9</b> Next steps</a><ul>
<li class="chapter" data-level="9.1" data-path="next.html"><a href="next.html#automated-reporting-with-rmarkdown"><i class="fa fa-check"></i><b>9.1</b> Automated reporting with RMarkdown</a></li>
<li class="chapter" data-level="9.2" data-path="next.html"><a href="next.html#sharing-code"><i class="fa fa-check"></i><b>9.2</b> Sharing code</a></li>
<li class="chapter" data-level="9.3" data-path="next.html"><a href="next.html#asking-questions"><i class="fa fa-check"></i><b>9.3</b> Asking questions</a></li>
<li class="chapter" data-level="9.4" data-path="next.html"><a href="next.html#testimonials"><i class="fa fa-check"></i><b>9.4</b> Testimonials</a><ul>
<li class="chapter" data-level="9.4.1" data-path="next.html"><a href="next.html#r-for-professional-road-safety-analysts"><i class="fa fa-check"></i><b>9.4.1</b> R for professional road safety analysts</a></li>
<li class="chapter" data-level="9.4.2" data-path="next.html"><a href="next.html#r-in-a-road-safety-research-consultancy"><i class="fa fa-check"></i><b>9.4.2</b> R in a road safety research consultancy</a></li>
<li class="chapter" data-level="9.4.3" data-path="next.html"><a href="next.html#using-r-in-a-road-safety-charity"><i class="fa fa-check"></i><b>9.4.3</b> Using R in a road safety charity</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible road safety research with R: A practical introduction</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pkgs" class="section level1">
<h1><span class="header-section-number">4</span> R packages</h1>
<div id="what-are-packages" class="section level2">
<h2><span class="header-section-number">4.1</span> What are packages?</h2>
<p>R has over 15,000 packages published on the official ‘CRAN’ site and many more published on code sharing sites such as GitHub.
Packages are effectively plugins for R that extend it in many ways.
Packages are useful because they enhance the range of things you can do with R, providing additional functions, data and documentation that build on the core (known as ‘base’) R packages.
They range from general-purpose packages such as <code>tidyverse</code> and <code>sf</code> to domain-specific packages such as <code>stats19</code>.</p>
<p>This chapter demonstrates the package lifecycle with reference <code>stats19</code> and provides a taster of R’s visualisation capabilities with reference to the general purpose packages <code>ggplot2</code> and <code>dplyr</code>.
The <code>stats19</code> package is particularly relevant for reproducible road safety research: its purpose is to download and clean road traffic collision data from the UK’s Department for Transport.
Domain-specific packages such as <code>stats19</code> are often written by subject-matter experts, providing tried and tested solutions in a particular specialism. Packages available via CRAN are reviewed by code experts ? prior to being made available via CRAN (OR SIMILAR WORDING _ IE SOME SORT OF ASSURANCE PROCESS HAS HAPPENED..?)</p>
<p>Regardless of which packages you install and use, there are a number of steps you will take:<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></p>
<ol style="list-style-type: decimal">
<li>installing the package</li>
<li>loading the package</li>
<li>using the package</li>
<li>updating the package</li>
</ol>
<p>Of these, the third stage takes by far the most amount of time.
Stages 1, 2 and 4 are equally important, however: you cannot use a package unless it has been properly installed, loaded and, to get the best performance out of the latest version, updated when new versions are released.
We will learn each of these stages of the package lifecycle with the <code>stats19</code> package.</p>
</div>
<div id="the-stats19-r-package" class="section level2">
<h2><span class="header-section-number">4.2</span> The stats19 R package</h2>
<p>Like many packages, <code>stats19</code> was developed to meet a real world need.
STATS19 data is provided as a free and open resource by the Department for Transport, encouraging evidence-based and accountable road safety research and policy interventions.
However, researchers at the University of Leeds found that repeatedly downloading and formatting open STATS19 data was time-consuming, taking valuable resources away from more valuable (and fun) aspects of the research process.
Importantly, manually recoding the data,for example from <code>1</code> to <code>Fatal</code>, was error-prone.
By packaging-up code to reliably solve the problem for ourselves, we found that we could solve the problem in a free, open and reproducible way for everyone <span class="citation">(Lovelace et al. 2019)</span>.</p>
<p>By abstracting the process to its fundamental steps (download, read, format), the <code>stats19</code> package makes it easy to get the data into appropriate formats (of classes <code>tbl</code>, <code>data.frame</code> and <code>sf</code>), ready for further processing and analysis steps.
The package built on previous work <span class="citation">(Lovelace, Roberts, and Kellar 2016)</span> with several important improvements, including the conversion of crash data into geographic data in a <code>sf</code> data frame for geographic research <span class="citation">(e.g. Austin, Tight, and Kirby 1997)</span>.
It enables creation of geographic representations of the crash data, geo-referenced to the correct coordinate reference system, in a single function, called <code>format_sf()</code>.
Part funded by the RAC Foundation, the package should be of use to academic researchers and professional road safety data analysts working at local authority and national levels in the UK.</p>
<p>The following sections demonstrate how to install, load and use packages with reference to <code>stats19</code>. This knowledge can be used to install, load and use any package.</p>
</div>
<div id="installing-packages" class="section level2">
<h2><span class="header-section-number">4.3</span> Installing packages</h2>
<p>The <code>stats19</code> package is available on CRAN.
This means that it has a web page on the CRAN website at <a href="https://cran.r-project.org">cran.r-project.org</a> — see <a href="https://cran.r-project.org/package=stats19">cran.r-project.org/package=stats19</a> — with useful information including who developed the package, what the latest version is and when it was last updated.
More importantly, being ‘on CRAN’ (which technically means ‘available on the <a href="https://cran.r-project.org/">Comprehensive R Archive Network</a>’) means that that it can be installed with the command <code>install.packages()</code> as follows:<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="pkgs.html#cb60-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;stats19&quot;</span>)</span></code></pre></div>
<p>You might think that now that the package has been installed we can start using it, but that is not true. This is illustrated in the below code which tries and fails to run the <code>find_file_name()</code> function from the <code>stats19</code> package to find the file containing STATS19 casualties data for the year 2019. (check that this function exists by running the following command <code>?find_file_name</code>):</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="pkgs.html#cb61-1"></a><span class="kw">find_file_name</span>(<span class="dt">years =</span> <span class="dv">2019</span>, <span class="dt">type =</span> <span class="st">&quot;casualties&quot;</span>)</span></code></pre></div>
<pre><code>## Error in find_file_name(years = 2019, type = &quot;casualties&quot;): could not find function &quot;find_file_name&quot;</code></pre>
</div>
<div id="loading-packages" class="section level2">
<h2><span class="header-section-number">4.4</span> Loading packages</h2>
<p>After you have installed a package the next step is to ‘load’ it.<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>
Load the <code>stats19</code> package, that was installed in the previous section, using the following code:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="pkgs.html#cb63-1"></a><span class="kw">library</span>(stats19)</span></code></pre></div>
<pre><code>## Data provided under OGL v3.0. Cite the source and link to:
## www.nationalarchives.gov.uk/doc/open-government-licence/version/3/</code></pre>
<p>What happened?
Other than the message telling us about the package’s datasets (most packages load silently so do not worry if nothing happens when you load a package), the command above made the functions and datasets in the package available to us.
Now we can use functions from the package without an error message, as follows:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="pkgs.html#cb65-1"></a><span class="kw">find_file_name</span>(<span class="dt">years =</span> <span class="dv">2019</span>, <span class="dt">type =</span> <span class="st">&quot;casualties&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;DfTRoadSafety_Casualties_2019.zip&quot;</code></pre>
<p>This raises the question: how do you know which functions are available in a particular package?
You can find out using autocompletion, by pressing <code>Tab</code> after typing the package’s name followed by two colons.
Try typing <code>stats19::</code> and then hitting <code>Tab</code>, for example.
You should see a load of function names appearing which you view by pressing <code>Up</code> and <code>Down</code> on your keyboard.</p>
<p>The final thing to say about packages is that you can use them without loading them by typing <code>package::function()</code>. We used this before in CHAPTER 2.8 where we imported csv data using the <code>readr</code> package via <code>readr::read_csv()</code>.<br />
So <code>stats19::find_file_name(years = 2019, type = "casualties")</code> works even if the package isn’t loaded.</p>
<p>You can test this by running the <code>sf_extSoftVersion()</code> command from the <code>sf</code> package. This command reports the versions of key geographic libraries installed on your system. In the first attempt below, the command fails and reports an error. In the second and third attempts, utilising <code>::</code> and <code>library</code>, you can see that the command succeeds:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="pkgs.html#cb67-1"></a><span class="co"># try running a function without loading the sf package first</span></span>
<span id="cb67-2"><a href="pkgs.html#cb67-2"></a><span class="kw">sf_extSoftVersion</span>()</span></code></pre></div>
<pre><code>## Error in sf_extSoftVersion(): could not find function &quot;sf_extSoftVersion&quot;</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="pkgs.html#cb69-1"></a><span class="co"># run a function from a package&#39;s namespace without loading it but using ::</span></span>
<span id="cb69-2"><a href="pkgs.html#cb69-2"></a>sf<span class="op">::</span><span class="kw">sf_extSoftVersion</span>()</span></code></pre></div>
<pre><code>##           GEOS           GDAL         proj.4 GDAL_with_GEOS     USE_PROJ_H 
##        &quot;3.8.0&quot;        &quot;3.0.4&quot;        &quot;6.3.1&quot;         &quot;true&quot;         &quot;true&quot;</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="pkgs.html#cb71-1"></a><span class="co"># fun a function call after loading the package (the most common way)</span></span>
<span id="cb71-2"><a href="pkgs.html#cb71-2"></a><span class="kw">library</span>(sf)</span></code></pre></div>
<pre><code>## Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="pkgs.html#cb73-1"></a><span class="kw">sf_extSoftVersion</span>()</span></code></pre></div>
<pre><code>##           GEOS           GDAL         proj.4 GDAL_with_GEOS     USE_PROJ_H 
##        &quot;3.8.0&quot;        &quot;3.0.4&quot;        &quot;6.3.1&quot;         &quot;true&quot;         &quot;true&quot;</code></pre>
<p>As a bonus, try running the command <code>sf::sf_extSoftVersion</code> without the brackets <code>()</code>.
What does that tell you about the package?</p>
</div>
<div id="using-packages" class="section level2">
<h2><span class="header-section-number">4.5</span> Using packages</h2>
<p>After loading a package, as described in the previous section, you can start using its functions.
In the <code>stats19</code> package that means the following command<code>get_stats19()</code> will now work:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="pkgs.html#cb75-1"></a>crashes_<span class="dv">2019</span> =<span class="st"> </span><span class="kw">get_stats19</span>(<span class="dt">year =</span> <span class="dv">2019</span>, <span class="dt">type =</span> <span class="st">&quot;accidents&quot;</span>)</span>
<span id="cb75-2"><a href="pkgs.html#cb75-2"></a><span class="kw">nrow</span>(crashes_<span class="dv">2019</span>)</span></code></pre></div>
<pre><code>## [1] 117536</code></pre>
<p>This command demonstrates the value of packages.
It would have been possible to get the same dataset by manually downloading and cleaning the file from the <a href="https://data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data">STATS19 website on data.gov.uk</a>.
However, by using the package the process has happened much faster and with fewer lines of code than would have been possible using general-purpose base R functions.
The result of the <code>nrow()</code> function call shows that we have downloaded a decent amount of data representing over 100k road traffic casualty incidents across Great Britain in 2019.</p>
<p>We will use other functions from the package in subsequent chapters.
If you would like to learn more about <code>stats19</code> and how it can be used for road safety research check out its vignettes.
The <code>stats19</code> vignette, for example, should appear in the <strong>Help</strong> panel in the bottom right panel in RStudio after running the following command:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="pkgs.html#cb77-1"></a><span class="kw">vignette</span>(<span class="st">&quot;stats19&quot;</span>)</span></code></pre></div>
</div>
<div id="updating-packages" class="section level2">
<h2><span class="header-section-number">4.6</span> Updating packages</h2>
<p>Packages can be updated with the command <code>update.package()</code> or in Tools &gt; Check for Package Updates in RStudio.
You only need to install a package once but packages can be updated many times. It is important to update packages regularly because ?????.
To update just one package, you can give the function a package name, e.g.:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="pkgs.html#cb78-1"></a><span class="kw">update.packages</span>(<span class="dt">oldPkgs =</span> <span class="st">&quot;stats19&quot;</span>)</span></code></pre></div>
<p>Completing the following short exercises will ensure you’ve got a good understanding of packages and package versions.</p>
<ol style="list-style-type: decimal">
<li>Take a look in the Packages tab in the Files pane in RStudio (bottom right by default).</li>
<li>What version of the <code>stats19</code> package is installed on your computer?</li>
<li>What happens the second time you run <code>update.packages()</code>. Why?</li>
</ol>
</div>
<div id="ggplot2" class="section level2">
<h2><span class="header-section-number">4.7</span> ggplot2</h2>
<p><code>ggplot2</code> is a generic plotting package that is part of the <a href="https://www.tidyverse.org/">‘tidyverse’</a> meta-package. The <code>tidyverse</code> is an “opinionated collection of R packages designed for data science”.
<!-- All packages in the tidyverse "share an underlying design philosophy, grammar, and data structures".  -->
<code>ggplot2</code> is flexible, popular and has dozens of add-on packages which build on it, such as <code>gganimate</code>.
To plot non-spatial data, it works as follows (the command should generate the image shown in Figure <a href="pkgs.html#fig:crashes2019time">4.1</a> and show a bar chart of the number of crashes by over time):</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="pkgs.html#cb79-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb79-2"><a href="pkgs.html#cb79-2"></a><span class="kw">ggplot</span>(crashes_<span class="dv">2019</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(date), <span class="dt">width =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span id="fig:crashes2019time"></span>
<img src="figures/crashes2019time-1.png" alt="A simple ggplot2 graph." width="672" />
<p class="caption">
Figure 4.1: A simple ggplot2 graph.
</p>
</div>
<p>A key feature of the <code>ggplot2</code> package is the function <code>ggplot2()</code>. This function initiates the creation of a plot by taking a data object as its main argument followed by one or more ‘geoms’ that represent layers (in this case a bar chart represented by the function <code>geom_bar()</code>).
Another distinctive feature of <code>ggplot2()</code> is the use of <code>+</code> operator to add layers.</p>
<p>The package is excellent for generating publication quality figures.
Starting from a basic idea, you can make incremental tweaks to a plot to get the output you want.
Building on the figure above, we could make the bin width (width of the bars) wider, add colour depending on the crash severity and use count or proportion as our y axis, for example, as follows:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="pkgs.html#cb80-1"></a><span class="kw">ggplot</span>(crashes_<span class="dv">2019</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(date, <span class="dt">fill =</span> accident_severity), <span class="dt">width =</span> <span class="dv">1</span>)</span>
<span id="cb80-2"><a href="pkgs.html#cb80-2"></a><span class="kw">ggplot</span>(crashes_<span class="dv">2019</span>) <span class="op">+</span></span>
<span id="cb80-3"><a href="pkgs.html#cb80-3"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(date, <span class="dt">fill =</span> accident_severity), <span class="dt">width =</span> <span class="dv">1</span>, <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></span>
<span id="cb80-4"><a href="pkgs.html#cb80-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Proportion of crashes&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:ggpropcrashes"></span>
<img src="figures/ggpropcrashes-1.png" alt="Demonstration of fill and position arguments in ggplot2." width="49%" /><img src="figures/ggpropcrashes-2.png" alt="Demonstration of fill and position arguments in ggplot2." width="49%" />
<p class="caption">
Figure 4.2: Demonstration of fill and position arguments in ggplot2.
</p>
</div>
<p>The package is huge and powerful, with support for a very wide range of plot types and themes, so it is worth taking time to read the documentation associated with the package, starting with the online <a href="https://ggplot2.tidyverse.org/reference/index.html">reference manual</a> and heading towards the online version of the package’s official <a href="https://ggplot2-book.org/">book</a> <span class="citation">(Wickham 2016)</span>.
As a final taught bit of <code>ggplot2</code> code in this chapter, create a facetted plot showing how the number of crashes per hour varies across the days of the week by typing the following into the Source Editor and running the chunk line-by-line (the meaning of the commands should become clear by the end of the next Chapter):</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="pkgs.html#cb81-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb81-2"><a href="pkgs.html#cb81-2"></a>crashes_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-3"><a href="pkgs.html#cb81-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> lubridate<span class="op">::</span><span class="kw">hour</span>(datetime)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-4"><a href="pkgs.html#cb81-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">day =</span> lubridate<span class="op">::</span><span class="kw">wday</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-5"><a href="pkgs.html#cb81-5"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(hour)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-6"><a href="pkgs.html#cb81-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(hour, <span class="dt">fill =</span> accident_severity)) <span class="op">+</span></span>
<span id="cb81-7"><a href="pkgs.html#cb81-7"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">width =</span> <span class="fl">1.01</span>) <span class="op">+</span></span>
<span id="cb81-8"><a href="pkgs.html#cb81-8"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>day)</span></code></pre></div>
<div class="figure"><span id="fig:ggfacetr"></span>
<img src="figures/ggfacetr-1.png" alt="A plot showing a facetted time series plot made with ggplot2." width="672" />
<p class="caption">
Figure 4.3: A plot showing a facetted time series plot made with ggplot2.
</p>
</div>
<p><strong>Exercises:</strong>
1. Install a package that build on <code>ggplot2</code> that begins with with <code>gg</code>. Hint: enter <code>install.packages(gg)</code> and hit Tab when your cursor is between the <code>g</code> and the <code>)</code>.
1. Open a help page in the newly installed package with the <code>?package_name::function()</code> syntax.
1. Load the package.
1. <strong>Bonus:</strong> try using functionality from the new ‘gg’ package building on the example above to create plots like those shown below (hint: the right plot below uses the economist theme from the <code>ggthemes</code> package, try other themes).</p>
<p><img src="figures/ggtheme-plot.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="dplyr" class="section level2">
<h2><span class="header-section-number">4.8</span> dplyr</h2>
<p>Another useful package in the tidyverse is <code>dplyr</code>, which stands for ‘data pliers’ and provides a handy syntax for data manipulation.
<code>dplyr</code> has many functions for manipulating data frames and using the pipe operator <code>%&gt;%</code>.
The pipe operator puts the output of one command into the first argument of the next, as shown below (note the results are the same):</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="pkgs.html#cb82-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb82-2"><a href="pkgs.html#cb82-2"></a><span class="kw">class</span>(crashes)       </span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="pkgs.html#cb84-1"></a>crashes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>We will learn more about this package and its other functions in Chapter <a href="data.html#data">5</a>.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="11">
<li id="fn11"><p>
If for whatever reason you want to uninstall a package you can uninstall it in a fifth stage with commands such as <code>remove.packages("stats19")</code>.<a href="pkgs.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>
To install the development version, which may have new features or but fixes that are not yet on CRAN, you can use the function<code>remotes::install_github("org/pkg")</code>.
The <code>stats19</code> package is hosted on the rOpenSci organisation at <a href="https://github.com/ropensci/stats19">github.com/ropensci/stats19</a>, so you can install the development version with <code>remotes::install_github("ropensci/stats19")</code> (you must have the <code>remotes</code> package installed before that will work).
Note: it’s usually safest to stick with the latest version on CRAN unless you know what you’re doing.<a href="pkgs.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>
Technically, this means that the <em>package namespace has been attached to the search path</em>, making their functions available from the global environment <span class="citation">(Wickham 2014)</span>.<a href="pkgs.html#fnref13" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rstudio.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/saferactive/rrsrr/edit/master/04-pkgs.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/saferactive/rrsrr/blob/master/04-pkgs.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
