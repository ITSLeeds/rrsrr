<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Manipulating data | Reproducible road safety research with R: A practical introduction</title>
  <meta name="description" content="A reproducible and open source approach to applied road safety research" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Manipulating data | Reproducible road safety research with R: A practical introduction" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ITSLeeds.github.io/rrsrr/" />
  
  <meta property="og:description" content="A reproducible and open source approach to applied road safety research" />
  <meta name="github-repo" content="ITSLeeds/rrsrr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Manipulating data | Reproducible road safety research with R: A practical introduction" />
  
  <meta name="twitter:description" content="A reproducible and open source approach to applied road safety research" />
  

<meta name="author" content="Robin Lovelace" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="pkgs.html"/>
<link rel="next" href="time.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#foreword-matt-staton"><i class="fa fa-check"></i>Foreword: Matt Staton</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#forword-john-wilkins"><i class="fa fa-check"></i>Forword: John Wilkins</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#preface"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thanks"><i class="fa fa-check"></i>Thanks</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#reproducibility"><i class="fa fa-check"></i><b>1.1</b> Reproducibility</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-is-r"><i class="fa fa-check"></i><b>1.2</b> What is R?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#why-r-for-road-safety-research"><i class="fa fa-check"></i><b>1.3</b> Why R for road safety research?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>1.4</b> Prerequisites</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#installing-r-and-rstudio"><i class="fa fa-check"></i><b>1.5</b> Installing R and RStudio</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#r-in-the-cloud"><i class="fa fa-check"></i><b>1.6</b> R in the cloud</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#install-pkgs"><i class="fa fa-check"></i><b>1.7</b> Recommended packages</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#overview"><i class="fa fa-check"></i><b>1.8</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> R basics</a><ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#creating-and-removing-r-objects"><i class="fa fa-check"></i><b>2.1</b> Creating and removing R objects</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#object-types-vectors-and-data-frames"><i class="fa fa-check"></i><b>2.2</b> Object types: vectors and data frames</a></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#subsetting-by-index-or-column-name"><i class="fa fa-check"></i><b>2.3</b> Subsetting by index or column name</a></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#subsetting-by-values"><i class="fa fa-check"></i><b>2.4</b> Subsetting by values</a></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#dealing-with-nas-and-recoding"><i class="fa fa-check"></i><b>2.5</b> Dealing with NAs and recoding</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#changing-class"><i class="fa fa-check"></i><b>2.6</b> Changing class</a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#recoding-values"><i class="fa fa-check"></i><b>2.7</b> Recoding values</a></li>
<li class="chapter" data-level="2.8" data-path="basics.html"><a href="basics.html#saving-r-objects"><i class="fa fa-check"></i><b>2.8</b> Saving R objects</a></li>
<li class="chapter" data-level="2.9" data-path="basics.html"><a href="basics.html#now-you-are-ready-to-use-rstudio"><i class="fa fa-check"></i><b>2.9</b> Now you are ready to use RStudio</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>3</b> Using RStudio</a><ul>
<li class="chapter" data-level="3.1" data-path="rstudio.html"><a href="rstudio.html#projects-and-scripts"><i class="fa fa-check"></i><b>3.1</b> Projects and scripts</a></li>
<li class="chapter" data-level="3.2" data-path="rstudio.html"><a href="rstudio.html#writing-and-running-code"><i class="fa fa-check"></i><b>3.2</b> Writing and running code</a></li>
<li class="chapter" data-level="3.3" data-path="rstudio.html"><a href="rstudio.html#viewing-objects"><i class="fa fa-check"></i><b>3.3</b> Viewing Objects</a></li>
<li class="chapter" data-level="3.4" data-path="rstudio.html"><a href="rstudio.html#autocompletion"><i class="fa fa-check"></i><b>3.4</b> Autocompletion</a></li>
<li class="chapter" data-level="3.5" data-path="rstudio.html"><a href="rstudio.html#getting-help"><i class="fa fa-check"></i><b>3.5</b> Getting help</a></li>
<li class="chapter" data-level="3.6" data-path="rstudio.html"><a href="rstudio.html#commenting-code"><i class="fa fa-check"></i><b>3.6</b> Commenting Code</a></li>
<li class="chapter" data-level="3.7" data-path="rstudio.html"><a href="rstudio.html#the-global-environment"><i class="fa fa-check"></i><b>3.7</b> The global environment</a></li>
<li class="chapter" data-level="3.8" data-path="rstudio.html"><a href="rstudio.html#debugging-code"><i class="fa fa-check"></i><b>3.8</b> Debugging Code</a></li>
<li class="chapter" data-level="3.9" data-path="rstudio.html"><a href="rstudio.html#productivity-boosting-features"><i class="fa fa-check"></i><b>3.9</b> Productivity boosting features</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pkgs.html"><a href="pkgs.html"><i class="fa fa-check"></i><b>4</b> R packages</a><ul>
<li class="chapter" data-level="4.1" data-path="pkgs.html"><a href="pkgs.html#what-are-packages"><i class="fa fa-check"></i><b>4.1</b> What are packages?</a></li>
<li class="chapter" data-level="4.2" data-path="pkgs.html"><a href="pkgs.html#the-stats19-r-package"><i class="fa fa-check"></i><b>4.2</b> The stats19 R package</a></li>
<li class="chapter" data-level="4.3" data-path="pkgs.html"><a href="pkgs.html#installing-packages"><i class="fa fa-check"></i><b>4.3</b> Installing packages</a></li>
<li class="chapter" data-level="4.4" data-path="pkgs.html"><a href="pkgs.html#loading-packages"><i class="fa fa-check"></i><b>4.4</b> Loading packages</a></li>
<li class="chapter" data-level="4.5" data-path="pkgs.html"><a href="pkgs.html#using-packages"><i class="fa fa-check"></i><b>4.5</b> Using packages</a></li>
<li class="chapter" data-level="4.6" data-path="pkgs.html"><a href="pkgs.html#updating-packages"><i class="fa fa-check"></i><b>4.6</b> Updating packages</a></li>
<li class="chapter" data-level="4.7" data-path="pkgs.html"><a href="pkgs.html#ggplot2"><i class="fa fa-check"></i><b>4.7</b> ggplot2</a></li>
<li class="chapter" data-level="4.8" data-path="pkgs.html"><a href="pkgs.html#dplyr"><i class="fa fa-check"></i><b>4.8</b> dplyr</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>5</b> Manipulating data</a><ul>
<li class="chapter" data-level="5.1" data-path="data.html"><a href="data.html#tibbles"><i class="fa fa-check"></i><b>5.1</b> tibbles</a></li>
<li class="chapter" data-level="5.2" data-path="data.html"><a href="data.html#filter-and-select-rows-and-columns"><i class="fa fa-check"></i><b>5.2</b> filter() and select() rows and columns</a></li>
<li class="chapter" data-level="5.3" data-path="data.html"><a href="data.html#ordering-and-selecting-the-top-n"><i class="fa fa-check"></i><b>5.3</b> Ordering and selecting the ‘top n’</a></li>
<li class="chapter" data-level="5.4" data-path="data.html"><a href="data.html#summarise"><i class="fa fa-check"></i><b>5.4</b> Summarise</a></li>
<li class="chapter" data-level="5.5" data-path="data.html"><a href="data.html#tidyverse-exercises"><i class="fa fa-check"></i><b>5.5</b> Tidyverse exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>6</b> Temporal data</a><ul>
<li class="chapter" data-level="6.1" data-path="time.html"><a href="time.html#temporal-analysis-of-crash-data"><i class="fa fa-check"></i><b>6.1</b> Temporal analysis of crash data</a></li>
<li class="chapter" data-level="6.2" data-path="time.html"><a href="time.html#handling-dates-and-date-times"><i class="fa fa-check"></i><b>6.2</b> Handling dates and date-times</a></li>
<li class="chapter" data-level="6.3" data-path="time.html"><a href="time.html#hours-minutes-seconds-with-hms"><i class="fa fa-check"></i><b>6.3</b> Hours, minutes seconds with hms</a></li>
<li class="chapter" data-level="6.4" data-path="time.html"><a href="time.html#the-lubridate-package"><i class="fa fa-check"></i><b>6.4</b> The lubridate package</a></li>
<li class="chapter" data-level="6.5" data-path="time.html"><a href="time.html#dates-in-a-data-frame"><i class="fa fa-check"></i><b>6.5</b> Dates in a data frame</a></li>
<li class="chapter" data-level="6.6" data-path="time.html"><a href="time.html#components-of-time-objects"><i class="fa fa-check"></i><b>6.6</b> Components of time objects</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="space.html"><a href="space.html"><i class="fa fa-check"></i><b>7</b> Spatial data</a><ul>
<li class="chapter" data-level="7.1" data-path="space.html"><a href="space.html#sf-objects"><i class="fa fa-check"></i><b>7.1</b> sf objects</a></li>
<li class="chapter" data-level="7.2" data-path="space.html"><a href="space.html#reading-and-writing-spatial-data"><i class="fa fa-check"></i><b>7.2</b> Reading and writing spatial data</a></li>
<li class="chapter" data-level="7.3" data-path="space.html"><a href="space.html#sf-polygons"><i class="fa fa-check"></i><b>7.3</b> sf polygons</a></li>
<li class="chapter" data-level="7.4" data-path="space.html"><a href="space.html#spatial-subsetting-and-sf-plotting"><i class="fa fa-check"></i><b>7.4</b> Spatial subsetting and sf plotting</a></li>
<li class="chapter" data-level="7.5" data-path="space.html"><a href="space.html#geographic-joins"><i class="fa fa-check"></i><b>7.5</b> Geographic joins</a></li>
<li class="chapter" data-level="7.6" data-path="space.html"><a href="space.html#coordinate-reference-systems"><i class="fa fa-check"></i><b>7.6</b> Coordinate Reference Systems</a></li>
<li class="chapter" data-level="7.7" data-path="space.html"><a href="space.html#buffers"><i class="fa fa-check"></i><b>7.7</b> Buffers</a></li>
<li class="chapter" data-level="7.8" data-path="space.html"><a href="space.html#attribute-operations-on-sf-objects"><i class="fa fa-check"></i><b>7.8</b> Attribute operations on sf objects</a></li>
<li class="chapter" data-level="7.9" data-path="space.html"><a href="space.html#mapping-road-crash-data"><i class="fa fa-check"></i><b>7.9</b> Mapping road crash data</a></li>
<li class="chapter" data-level="7.10" data-path="space.html"><a href="space.html#analysing-point-data"><i class="fa fa-check"></i><b>7.10</b> Analysing point data</a></li>
<li class="chapter" data-level="7.11" data-path="space.html"><a href="space.html#analysing-crash-data-on-road-networks"><i class="fa fa-check"></i><b>7.11</b> Analysing crash data on road networks</a></li>
<li class="chapter" data-level="" data-path="space.html"><a href="space.html#bonus-exercises"><i class="fa fa-check"></i>Bonus exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="join.html"><a href="join.html"><i class="fa fa-check"></i><b>8</b> Joining road crash tables</a><ul>
<li class="chapter" data-level="8.1" data-path="join.html"><a href="join.html#stats19-tables"><i class="fa fa-check"></i><b>8.1</b> STATS19 tables</a></li>
<li class="chapter" data-level="8.2" data-path="join.html"><a href="join.html#joining-casualty-data"><i class="fa fa-check"></i><b>8.2</b> Joining casualty data</a></li>
<li class="chapter" data-level="8.3" data-path="join.html"><a href="join.html#joining-vehicle-data"><i class="fa fa-check"></i><b>8.3</b> Joining vehicle data</a></li>
<li class="chapter" data-level="8.4" data-path="join.html"><a href="join.html#case-study-london"><i class="fa fa-check"></i><b>8.4</b> Case study: London</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="next-steps.html"><a href="next-steps.html"><i class="fa fa-check"></i><b>9</b> Next steps</a><ul>
<li class="chapter" data-level="9.1" data-path="next-steps.html"><a href="next-steps.html#automated-reporting-with-rmarkdown"><i class="fa fa-check"></i><b>9.1</b> Automated reporting with RMarkdown</a></li>
<li class="chapter" data-level="9.2" data-path="next-steps.html"><a href="next-steps.html#sharing-code"><i class="fa fa-check"></i><b>9.2</b> Sharing code</a></li>
<li class="chapter" data-level="9.3" data-path="next-steps.html"><a href="next-steps.html#asking-questions"><i class="fa fa-check"></i><b>9.3</b> Asking questions</a></li>
<li class="chapter" data-level="9.4" data-path="next-steps.html"><a href="next-steps.html#testimonials"><i class="fa fa-check"></i><b>9.4</b> Testimonials</a><ul>
<li class="chapter" data-level="9.4.1" data-path="next-steps.html"><a href="next-steps.html#r-for-professional-road-safety-analysts"><i class="fa fa-check"></i><b>9.4.1</b> R for professional road safety analysts</a></li>
<li class="chapter" data-level="9.4.2" data-path="next-steps.html"><a href="next-steps.html#r-in-a-road-safety-research-consultancy"><i class="fa fa-check"></i><b>9.4.2</b> R in a road safety research consultancy</a></li>
<li class="chapter" data-level="9.4.3" data-path="next-steps.html"><a href="next-steps.html#using-r-in-a-road-safety-charity"><i class="fa fa-check"></i><b>9.4.3</b> Using R in a road safety charity</a></li>
<li class="chapter" data-level="9.4.4" data-path="next-steps.html"><a href="next-steps.html#using-r-in-other-areas-of-road-safety-research"><i class="fa fa-check"></i><b>9.4.4</b> Using R in other areas of road safety research</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
<li class="chapter" data-level="11" data-path="rrsrr.html"><a href="rrsrr.html"><i class="fa fa-check"></i><b>11</b> rrsrr</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible road safety research with R: A practical introduction</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1">
<h1><span class="header-section-number">5</span> Manipulating data</h1>
<p>This section is an introduction to manipulating datasets using the <code>dplyr</code> package.
As outlined in the previous section, <code>dplyr</code> and <code>ggplot2</code> are part of the <code>tidyverse</code>, which aims to provide a user-friendly framework for data science <span class="citation">(Grolemund and Wickham 2016)</span>.</p>
<p>Experience of teaching R over the past few years suggests that many people find it easier to get going with data driven research if they learn the ‘tidy’ workflow presented in this section.
However, if you do not like this style of R code or you are simply curious, we encourage you to try alternative approaches for achieving the similar results using base R <span class="citation">(R Core Team 2020b)</span><a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a>
, the <code>data.table</code> R package <span class="citation">(Dowle and Srinivasan 2019)</span> or other languages such as <a href="https://www.python.org/">Python</a> or <a href="https://julialang.org/">Julia</a>.
If you just want to get going with processing data, the <code>tidyverse</code> is a solid and popular starting point.</p>
<!-- Todo: add new part here? -->
<p>Before diving into the <code>tidyverse</code>, it is worth re-capping where we have got to so far as we have covered a lot of ground.
Section <a href="basics.html#basics">2</a> introduced R’s basic syntax; Section <a href="rstudio.html#rstudio">3</a> showed how to use the Source Editor and other features of RStudio to support data science; and Section <a href="pkgs.html#pkgs">4</a> introduced the concept and practicalities of R packages, with reference to <code>stats19</code>, <code>ggplot2</code> and <code>dplyr</code>.</p>
<p>In this section, we will start with a blank slate.
In Section <a href="basics.html#basics">2</a> we learned that in R having a ‘clear desk’ means an <em>empty global environment</em>.
This can be achieved by running the following command, which removes the <code>list()</code> of all objects returned by the function <code>ls()</code>:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="data.html#cb85-1"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span></code></pre></div>
<div id="tibbles" class="section level2">
<h2><span class="header-section-number">5.1</span> tibbles</h2>
<p>Although the data processing techniques in R are capable of handling large datasets, such as the <code>crashes_2019</code> object that we created in the previous section, representing 100k+ casualties, it makes sense to start small.
Let’s start by re-creating the <code>crashes</code> dataset from Section <a href="basics.html#basics">2</a>, but this time using the <code>tidyverse</code> <code>tibble()</code> function. This is the <code>tidyverse</code> equivalent of base R’s <code>data.frame</code>.
<code>tibble</code> objects can be created, after loading the <code>tidyverse</code>, as follows:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="data.html#cb86-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb86-2"><a href="data.html#cb86-2"></a>crashes =<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb86-3"><a href="data.html#cb86-3"></a>  <span class="dt">casualty_type =</span> <span class="kw">c</span>(<span class="st">&quot;pedestrian&quot;</span>, <span class="st">&quot;cyclist&quot;</span>, <span class="st">&quot;cat&quot;</span>),</span>
<span id="cb86-4"><a href="data.html#cb86-4"></a>  <span class="dt">casualty_age =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">20</span>, <span class="dt">to =</span> <span class="dv">60</span>, <span class="dt">by =</span> <span class="dv">20</span>),</span>
<span id="cb86-5"><a href="data.html#cb86-5"></a>  <span class="dt">vehicle_type =</span> <span class="kw">c</span>(<span class="st">&quot;car&quot;</span>, <span class="st">&quot;bus&quot;</span>, <span class="st">&quot;tank&quot;</span>),</span>
<span id="cb86-6"><a href="data.html#cb86-6"></a>  <span class="dt">dark =</span> <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)</span>
<span id="cb86-7"><a href="data.html#cb86-7"></a>)</span></code></pre></div>
<p>In the previous code chunk, we passed four vector objects as <em>named arguments</em> to the <code>tibble</code> function, resulting in columns such as <code>casualty_type</code>.
A <code>tibble</code> is just a fancy way of representing <code>data.frame</code> objects, preferred by <code>tidyverse</code> users and optimised for data science.
It has a few sensible defaults and advantages compared with the <code>data.frame</code>, one of which can be seen by printing a <code>tibble</code>:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="data.html#cb87-1"></a><span class="kw">class</span>(crashes)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="data.html#cb89-1"></a>crashes</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   casualty_type casualty_age vehicle_type dark 
##   &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;        &lt;lgl&gt;
## 1 pedestrian              20 car          TRUE 
## 2 cyclist                 40 bus          FALSE
## 3 cat                     60 tank         TRUE</code></pre>
<p>Note the <code>&lt;chr&gt;</code>, <code>&lt;dbl&gt;</code> or <code>&lt;lgl&gt;</code> text below each column, providing a quick indication of the class of each variable - this is not provided when using <code>data.frame</code>.</p>
</div>
<div id="filter-and-select-rows-and-columns" class="section level2">
<h2><span class="header-section-number">5.2</span> filter() and select() rows and columns</h2>
<p>In the previous section, we briefly introduced the package <code>dplyr</code>, which provides an alternative to base R for manipulating objects. <code>dplyr</code> provides different, and some would argue simpler, approaches for subsetting rows and columns than base R.<br />
<code>dplyr</code> operations for subsetting rows (with the function <code>filter()</code>) and columns (with the function <code>select()</code>) are demonstrated below. Here we can also see the use of the pipe operator <code>%&gt;%</code> to take the dataset and apply the function to that dataset.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="data.html#cb91-1"></a>crashes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(casualty_age <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>) <span class="co"># filters rows</span></span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   casualty_type casualty_age vehicle_type dark 
##   &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;        &lt;lgl&gt;
## 1 cat                     60 tank         TRUE</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="data.html#cb93-1"></a>crashes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(casualty_type) <span class="co"># select just one column</span></span></code></pre></div>
<pre><code>## # A tibble: 3 x 1
##   casualty_type
##   &lt;chr&gt;        
## 1 pedestrian   
## 2 cyclist      
## 3 cat</code></pre>
<p>It should be clear what happened: <code>filter()</code> returns only rows that match the criteria in the function call, only observations with a <code>casualty_age</code> greater than 50 in this case.
Likewise, <code>select()</code> returns data objects that include only columns named inside the function call, <code>casualty_type</code> in this case.</p>
<p>To gain a greater understanding of the functions, type and run the following commands, which also illustrate how the <code>%&gt;%</code> can be used more than once to manipulate data (more on this soon):</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="data.html#cb95-1"></a>crashes_darkness =<span class="st"> </span>crashes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dark)</span>
<span id="cb95-2"><a href="data.html#cb95-2"></a>crashes_a =<span class="st"> </span>crashes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&quot;a&quot;</span>))</span>
<span id="cb95-3"><a href="data.html#cb95-3"></a>crashes_darkness_a =<span class="st"> </span>crashes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-4"><a href="data.html#cb95-4"></a><span class="st">  </span><span class="kw">filter</span>(dark) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-5"><a href="data.html#cb95-5"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&quot;a&quot;</span>))</span></code></pre></div>
<p>Can you guess what the dimensions of the resulting objects will be?
Write down your guesses for the number of rows and number of columns that the new objects, <code>crashes_darkness</code> to <code>crashes_darkness_a</code>, have before running the following commands to find out. This also demonstrates the handy function <code>dim()</code>, short for dimension (results not shown):<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="data.html#cb96-1"></a><span class="kw">dim</span>(crashes)</span>
<span id="cb96-2"><a href="data.html#cb96-2"></a><span class="kw">dim</span>(crashes_darkness)</span>
<span id="cb96-3"><a href="data.html#cb96-3"></a>?contains <span class="co"># get help on contains() to help guess the output of the next line</span></span>
<span id="cb96-4"><a href="data.html#cb96-4"></a><span class="kw">dim</span>(crashes_a)</span>
<span id="cb96-5"><a href="data.html#cb96-5"></a><span class="kw">dim</span>(crashes_darkness_a)</span></code></pre></div>
<p>Look at the help pages associated with <code>filter()</code>, <code>select()</code> and the related function <code>slice()</code> as follows and try running the examples that you will find at the bottom of the help pages for each to gain a greater understanding (note you can use the <code>package::function</code> notation to get help on functions also):</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="data.html#cb97-1"></a>?dplyr<span class="op">::</span>filter</span>
<span id="cb97-2"><a href="data.html#cb97-2"></a>?dplyr<span class="op">::</span>select</span>
<span id="cb97-3"><a href="data.html#cb97-3"></a>?dplyr<span class="op">::</span>slice</span></code></pre></div>
</div>
<div id="ordering-and-selecting-the-top-n" class="section level2">
<h2><span class="header-section-number">5.3</span> Ordering and selecting the ‘top n’</h2>
<p>Other useful pipe-friendly functions are <code>arrange()</code> and <code>top_n()</code>. <code>arrange()</code> can be used to sort data. Within. the <code>arrage()</code> function, optional arguments can be used to define the order in which it is sorted. <code>top_n()</code>simply selects the top ‘n’ number of rows in your data frame.
We can use these functions to arrange datasets and take the top most ‘n’ values, as follows:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="data.html#cb98-1"></a>crashes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb98-2"><a href="data.html#cb98-2"></a><span class="st">  </span><span class="kw">arrange</span>(vehicle_type)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   casualty_type casualty_age vehicle_type dark 
##   &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;        &lt;lgl&gt;
## 1 cyclist                 40 bus          FALSE
## 2 pedestrian              20 car          TRUE 
## 3 cat                     60 tank         TRUE</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="data.html#cb100-1"></a>crashes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb100-2"><a href="data.html#cb100-2"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">wt =</span> casualty_age)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   casualty_type casualty_age vehicle_type dark 
##   &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;        &lt;lgl&gt;
## 1 cat                     60 tank         TRUE</code></pre>
<!-- ## Long and wide data -->
</div>
<div id="summarise" class="section level2">
<h2><span class="header-section-number">5.4</span> Summarise</h2>
<p>A powerful two-function combination is <code>group_by()</code> and <code>summarise()</code>.
Used together, they can provide <em>grouped summaries</em> of datasets.
In the example below, we find the mean age of casualties in dark and light conditions.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="data.html#cb102-1"></a>crashes <span class="op">%&gt;%</span></span>
<span id="cb102-2"><a href="data.html#cb102-2"></a><span class="st">  </span><span class="kw">group_by</span>(dark) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-3"><a href="data.html#cb102-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_age =</span> <span class="kw">mean</span>(casualty_age))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   dark  mean_age
##   &lt;lgl&gt;    &lt;dbl&gt;
## 1 FALSE       40
## 2 TRUE        40</code></pre>
<p>The example above shows a powerful feature of these pipelines. Many operations can be ‘chained’ together, whilst keeping readability with subsequent commands stacked below earlier operations. The combination of <code>group_by()</code> and <code>summarise()</code> can be very useful in preparing data for visualisation with a <code>ggplot2</code> function.
Another useful feature of the <code>tidyverse</code> from a user perspective is the autocompletion of column names mid pipe.
If you have not noticed this already, you can test it by typing the following, putting your cursor just before the <code>)</code> and pressing <code>Tab</code>:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="data.html#cb105-1"></a>crashes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(ca) <span class="co"># press Tab when your cursor is just after the a</span></span></code></pre></div>
<p>You should see <code>casualty_age</code> and <code>casualty_type</code> pop up as options that can be selected by pressing <code>Up</code> and <code>Down</code>.
This may not seem like much, but when analysing large datasets with dozens of variables, it can be a godsend.</p>
<p>Rather than providing a comprehensive introduction to the <code>tidyverse</code> suite of packages, this section should have offered enough to get started with using it for road safety data analysis.
For further information, check out up-to-date online courses from respected organisations like <a href="https://datacarpentry.org/R-ecology-lesson/index.html">Data Carpentry</a> and the free online <a href="https://bookdown.org/">books</a> such as <a href="(https://r4ds.had.co.nz/)">R for Data Science</a> <span class="citation">(Grolemund and Wickham 2016)</span>.</p>
</div>
<div id="tidyverse-exercises" class="section level2">
<h2><span class="header-section-number">5.5</span> Tidyverse exercises</h2>
<ol style="list-style-type: decimal">
<li>Use <code>dplyr</code> to filter rows in which <code>casualty_age</code> is less than 18, and then 28.</li>
<li>Use the <code>arrange</code> function to sort the <code>crashes</code> object in descending order of age (<strong>Hint:</strong> see the <code>?arrange</code> help page).</li>
<li>Read the help page of <code>dplyr::mutate()</code>. What does the function do?</li>
<li>Use the mutate function to create a new variable, <code>birth_year</code>, in the <code>crashes</code> data.frame which is defined as the current year minus their age.</li>
<li><strong>Bonus:</strong> Use the <code>%&gt;%</code> operator to filter the output from the previous exercise so that only observations with <code>birth_year</code> after 1969 are returned.</li>
</ol>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="15">
<li id="fn15"><p>
Run the command <code>help.start()</code> to see a resources introducing base R, and <a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.html#Lists-and-data-frames">Chapter 6 on lists and data frames</a> in <a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.pdf">An Introduction to R</a> in particular for an introduction to data manipulation with base R.<a href="data.html#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>
Note that the number of rows is reported before the number of columns.
This is a feature of R: rows are also specificiefied first when subsetting using the square brackets in commands such as <code>crashes[1, 2:3]</code>.<a href="data.html#fnref16" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pkgs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="time.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ITSLeeds/rrsrr/edit/master/05-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ITSLeeds/rrsrr/blob/master/05-data.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
